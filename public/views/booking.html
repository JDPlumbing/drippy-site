<script>
  function submitBooking(e) {
    e.preventDefault();

    const booking = {
      name: document.getElementById('custName').value,
      email: document.getElementById('custEmail').value,
      phone: document.getElementById('custPhone').value,
      contactName: document.getElementById('contactName').value,
      contactRole: document.getElementById('contactRole').value,
      contactPhone: document.getElementById('contactPhone').value,
      address: document.getElementById('jobAddress').value,
      description: document.getElementById('jobDescription').value,
      instructions: document.getElementById('specialInstructions').value,
      time1: document.getElementById('prefTime1').value,
      time2: document.getElementById('prefTime2').value,
      time3: document.getElementById('prefTime3').value,
      valveConsent: document.getElementById('valveCheckConsent').checked,
      submittedAt: new Date().toISOString()
    };

    // Save raw booking to localStorage
    localStorage.setItem('drippyBooking', JSON.stringify(booking));

    // Create structured job (uses job_builder.js)
    const formData = new FormData(document.getElementById('bookingForm'));
    const newJob = createJobFromBooking(formData);
    saveJobToLocalStorage(newJob);

    // Show success message
    const msg = document.getElementById('bookingConfirm');
    msg.innerHTML = `âœ… Booking submitted successfully!<br>We'll be in touch soon.`;
    msg.style.display = 'block';

    // Reset form
    document.getElementById('bookingForm').reset();

    // Optional: download job
    // downloadJobFile(newJob);
  }

  // Attach event listener once
  document.getElementById("bookingForm").addEventListener("submit", submitBooking);
</script>
