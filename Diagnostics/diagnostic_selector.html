
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drippy | Diagnostic Test Loader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 2em; }
    h1 { text-align: center; color: #1576d3; }
    .test-card { background: white; margin-bottom: 1em; padding: 1em; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .test-card h2 { margin: 0 0 0.5em 0; }
    .test-card p { margin: 0.3em 0; font-size: 0.95em; }
    .tag { display: inline-block; background: #e0f0ff; color: #1576d3; padding: 0.2em 0.5em; margin: 0.2em; border-radius: 4px; font-size: 0.8em; }
    select, button { font-size: 1em; padding: 0.5em; margin-top: 1em; }
  </style>
</head>
<body>

<h1>Drippy Diagnostic Selector</h1>

<div>
  <label for="roleSelect">Select Role:</label>
  <select id="roleSelect">
    <option value="customer">Customer</option>
    <option value="tech">Technician</option>
    <option value="admin">Admin</option>
  </select>
</div>

<div id="testContainer"></div>

<script>
const diagnosticIndex = [
  {
    "testId": "valveTest",
    "file": "valveTest.json",
    "title": "Main Shutoff Valve Test",
    "tags": ["valve", "supply", "emergency", "location"],
    "fixtureType": "supply_system",
    "minRole": "customer"
  },
  {
    "testId": "drainTest",
    "file": "drainTest.json",
    "title": "Drain Function Test",
    "tags": ["drain", "sink", "shower", "clog"],
    "fixtureType": "drainage_system",
    "minRole": "customer"
  },
  {
    "testId": "waterHeaterTest",
    "file": "waterHeaterTest.json",
    "title": "Water Heater Performance Test",
    "tags": ["heating", "hot water", "tank", "noisy", "leak"],
    "fixtureType": "water_heater",
    "minRole": "tech"
  },
  {
    "testId": "waterPressureTest",
    "file": "waterPressureTest.json",
    "title": "Water Pressure Evaluation",
    "tags": ["pressure", "supply", "aerator", "gauge"],
    "fixtureType": "supply_system",
    "minRole": "customer"
  }
];

const roleHierarchy = ["customer", "tech", "admin"];

function renderTests(role) {
  const container = document.getElementById("testContainer");
  container.innerHTML = "";

  diagnosticIndex.forEach(test => {
    if (roleHierarchy.indexOf(role) >= roleHierarchy.indexOf(test.minRole)) {
      const tagsHTML = test.tags.map(tag => `<span class="tag">${tag}</span>`).join(" ");
      container.innerHTML += `
        <div class="test-card">
          <h2>${test.title}</h2>
          <p><strong>Fixture Type:</strong> ${test.fixtureType.replace("_", " ")}</p>
          <p>${tagsHTML}</p>
          <button onclick="alert('Load ${test.file} via AJAX or file handler')">Start Test</button>
        </div>
      `;
    }
  });
}

document.getElementById("roleSelect").addEventListener("change", (e) => {
  renderTests(e.target.value);
});

renderTests("customer");  // Default role
</script>

</body>
</html>
